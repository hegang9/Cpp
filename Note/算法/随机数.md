# C++ 随机数生成

## 概述

C++ 提供了两种生成随机数的方法：
1. **C 风格**：使用 `<cstdlib>` 中的 `rand()` 和 `srand()` 函数（传统方法）
2. **C++11 风格**：使用 `<random>` 库（现代推荐方法）

---

## 方法一：C 风格随机数（rand/srand）

### 头文件
```cpp
#include <cstdlib>  // rand(), srand()
#include <ctime>    // time()
```

### 基本用法

#### 1. 设置随机数种子
```cpp
srand(time(0));  // 使用当前时间作为种子
```

**注意事项**：
- `srand()` **只应调用一次**，通常在程序开始时（`main()` 函数开头）
- 多次调用会重置随机数序列，导致生成相同的数
- `time(0)` 返回当前时间的秒数

#### 2. 生成随机数
```cpp
int random_num = rand();  // 生成 [0, RAND_MAX] 范围内的随机整数
```

### 生成指定范围的随机数

#### 生成 [0, n) 范围
```cpp
int random_num = rand() % n;
```

#### 生成 [min, max] 范围
```cpp
int random_num = min + rand() % (max - min + 1);
```

#### 生成 [0.0, 1.0) 范围的浮点数
```cpp
double random_double = (double)rand() / RAND_MAX;
```

#### 生成 [min, max) 范围的浮点数
```cpp
double random_double = min + (double)rand() / RAND_MAX * (max - min);
```

### 完整示例

```cpp
#include <iostream>
#include <cstdlib>
#include <ctime>

int main() {
    srand(time(0));  // 设置随机数种子（只调用一次）
    
    // 生成 10 个 [1, 100] 范围内的随机整数
    for (int i = 0; i < 10; i++) {
        int num = 1 + rand() % 100;
        std::cout << num << " ";
    }
    std::cout << std::endl;
    
    // 生成 5 个 [0.0, 1.0) 范围内的随机浮点数
    for (int i = 0; i < 5; i++) {
        double num = (double)rand() / RAND_MAX;
        std::cout << num << " ";
    }
    std::cout << std::endl;
    
    return 0;
}
```

### C 风格的缺点

1. **质量较差**：`rand()` 的随机性不够好，不适合加密等场景
2. **线程不安全**：在多线程环境下可能产生问题
3. **分布不均匀**：使用 `%` 运算符可能导致分布偏差
4. **全局状态**：`srand()` 影响全局状态，难以管理

---

## 方法二：C++11 随机数库（推荐）

### 头文件
```cpp
#include <random>
```

### 核心组件

C++11 随机数库采用**三层架构**：

1. **随机数引擎**（Random Engine）：生成随机数序列
2. **分布器**（Distribution）：将随机数映射到特定分布
3. **随机数种子**（Seed）：初始化引擎

### 常用随机数引擎

| 引擎 | 说明 | 性能 | 质量 |
|------|------|------|------|
| `std::default_random_engine` | 默认引擎（实现相关） | - | - |
| `std::mt19937` | 梅森旋转算法（32位） | 快 | 高 |
| `std::mt19937_64` | 梅森旋转算法（64位） | 快 | 高 |
| `std::random_device` | 真随机数生成器 | 慢 | 最高 |

### 常用分布器

#### 整数分布
- `std::uniform_int_distribution<T>`：均匀分布
- `std::binomial_distribution<T>`：二项分布
- `std::poisson_distribution<T>`：泊松分布

#### 浮点数分布
- `std::uniform_real_distribution<T>`：均匀分布
- `std::normal_distribution<T>`：正态分布
- `std::exponential_distribution<T>`：指数分布

### 基本用法

#### 1. 生成随机整数（均匀分布）

```cpp
#include <iostream>
#include <random>

int main() {
    // 创建随机数引擎，使用 random_device 作为种子
    std::random_device rd;
    std::mt19937 gen(rd());
    
    // 创建分布器：生成 [1, 100] 范围的整数
    std::uniform_int_distribution<int> dis(1, 100);
    
    // 生成 10 个随机数
    for (int i = 0; i < 10; i++) {
        std::cout << dis(gen) << " ";
    }
    std::cout << std::endl;
    
    return 0;
}
```

#### 2. 生成随机浮点数（均匀分布）

```cpp
#include <iostream>
#include <random>

int main() {
    std::random_device rd;
    std::mt19937 gen(rd());
    
    // 创建分布器：生成 [0.0, 1.0) 范围的浮点数
    std::uniform_real_distribution<double> dis(0.0, 1.0);
    
    for (int i = 0; i < 5; i++) {
        std::cout << dis(gen) << " ";
    }
    std::cout << std::endl;
    
    return 0;
}
```

#### 3. 生成正态分布随机数

```cpp
#include <iostream>
#include <random>

int main() {
    std::random_device rd;
    std::mt19937 gen(rd());
    
    // 正态分布：均值 = 0.0，标准差 = 1.0
    std::normal_distribution<double> dis(0.0, 1.0);
    
    for (int i = 0; i < 10; i++) {
        std::cout << dis(gen) << " ";
    }
    std::cout << std::endl;
    
    return 0;
}
```

### 实用示例

#### 示例 1：随机打乱数组

```cpp
#include <iostream>
#include <vector>
#include <random>
#include <algorithm>

int main() {
    std::vector<int> vec = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10};
    
    std::random_device rd;
    std::mt19937 gen(rd());
    
    // 使用 shuffle 随机打乱
    std::shuffle(vec.begin(), vec.end(), gen);
    
    for (int num : vec) {
        std::cout << num << " ";
    }
    std::cout << std::endl;
    
    return 0;
}
```

#### 示例 2：随机抽样

```cpp
#include <iostream>
#include <vector>
#include <random>

int main() {
    std::vector<std::string> names = {"Alice", "Bob", "Charlie", "David", "Eve"};
    
    std::random_device rd;
    std::mt19937 gen(rd());
    std::uniform_int_distribution<size_t> dis(0, names.size() - 1);
    
    // 随机抽取 3 个名字
    for (int i = 0; i < 3; i++) {
        size_t index = dis(gen);
        std::cout << names[index] << std::endl;
    }
    
    return 0;
}
```

#### 示例 3：模拟掷骰子

```cpp
#include <iostream>
#include <random>
#include <map>

int main() {
    std::random_device rd;
    std::mt19937 gen(rd());
    std::uniform_int_distribution<int> dis(1, 6);
    
    std::map<int, int> histogram;
    
    // 掷骰子 10000 次
    for (int i = 0; i < 10000; i++) {
        ++histogram[dis(gen)];
    }
    
    // 显示统计结果
    for (const auto& [value, count] : histogram) {
        std::cout << value << ": " << count << std::endl;
    }
    
    return 0;
}
```

#### 示例 4：生成随机字符串

```cpp
#include <iostream>
#include <string>
#include <random>

std::string generateRandomString(size_t length) {
    const std::string chars = 
        "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
    
    std::random_device rd;
    std::mt19937 gen(rd());
    std::uniform_int_distribution<size_t> dis(0, chars.size() - 1);
    
    std::string result;
    for (size_t i = 0; i < length; i++) {
        result += chars[dis(gen)];
    }
    
    return result;
}

int main() {
    std::cout << generateRandomString(10) << std::endl;
    std::cout << generateRandomString(20) << std::endl;
    
    return 0;
}
```

### 在类中使用随机数

```cpp
#include <random>
#include <vector>

class RandomizedSet {
public:
    RandomizedSet() : gen(std::random_device{}()) {
        // 在构造函数中初始化随机数引擎
    }
    
    void insert(int val) {
        data.push_back(val);
    }
    
    int getRandom() {
        std::uniform_int_distribution<size_t> dis(0, data.size() - 1);
        return data[dis(gen)];
    }
    
private:
    std::vector<int> data;
    std::mt19937 gen;  // 随机数引擎作为成员变量
};
```

---

## 固定种子（可复现随机）

在某些场景下（如调试、测试），需要生成**可复现**的随机数序列。

### C 风格
```cpp
srand(12345);  // 使用固定种子
int num1 = rand();
int num2 = rand();
// 每次运行结果相同
```

### C++11 风格
```cpp
std::mt19937 gen(12345);  // 使用固定种子
std::uniform_int_distribution<int> dis(1, 100);
int num1 = dis(gen);
int num2 = dis(gen);
// 每次运行结果相同
```

---

## 性能对比

| 方法 | 速度 | 质量 | 线程安全 | 推荐度 |
|------|------|------|----------|--------|
| `rand()` | 快 | 低 | 否 | ⭐ |
| `std::mt19937` | 快 | 高 | 是（独立实例） | ⭐⭐⭐⭐⭐ |
| `std::random_device` | 慢 | 最高 | 是 | ⭐⭐⭐（仅用于种子） |

---

## 常见错误

### 错误 1：重复调用 srand()
```cpp
// ❌ 错误
int getRandom() {
    srand(time(0));  // 每次调用都重置种子
    return rand();   // 短时间内返回相同值
}
```

```cpp
// ✅ 正确
void init() {
    srand(time(0));  // 只在初始化时调用一次
}

int getRandom() {
    return rand();
}
```

### 错误 2：使用 % 导致分布不均
```cpp
// ❌ 较差（可能不均匀）
int num = rand() % 100;

// ✅ 推荐（均匀分布）
std::uniform_int_distribution<int> dis(0, 99);
int num = dis(gen);
```

### 错误 3：全局共享随机数引擎
```cpp
// ❌ 不好（线程不安全）
std::mt19937 global_gen;

// ✅ 更好（每个线程独立）
thread_local std::mt19937 gen(std::random_device{}());
```

---

## 最佳实践

1. **优先使用 C++11 `<random>` 库**：质量更高，功能更强
2. **使用 `std::mt19937` 引擎**：性能和质量的最佳平衡
3. **使用 `std::random_device` 初始化种子**：确保每次运行不同
4. **在类中将引擎作为成员变量**：避免重复创建
5. **选择合适的分布器**：根据需求选择均匀、正态等分布
6. **线程环境使用 `thread_local`**：避免竞争条件

---

## 总结

| 场景 | 推荐方法 |
|------|----------|
| 简单随机整数 | `std::uniform_int_distribution` + `std::mt19937` |
| 随机浮点数 | `std::uniform_real_distribution` + `std::mt19937` |
| 正态分布 | `std::normal_distribution` + `std::mt19937` |
| 可复现随机 | 使用固定种子初始化引擎 |
| 真随机数 | `std::random_device`（但性能较慢） |
| 遗留代码 | `rand()` + `srand(time(0))`（不推荐新代码使用） |

现代 C++ 程序应该使用 `<random>` 库，它提供了更好的随机性、更多的分布选项和更强的类型安全。
